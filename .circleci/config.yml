orbs:
  sonar_analysis: taptapnetworks/sonar_analysis@2.0.0
version: 2.1
jobs:
  semantic_and_sonar_verify:
    docker:
      - image: 'circleci/node:latest'  
    steps:
      - checkout         
      - run: |
            sudo npm install -g sonarqube-scanner
      - run: 
            name: Run Sonarqube scanner
            command: |
                  eval /usr/local/bin/sonar-scanner  -Dsonar.projectKey=mynodeproj -Dsonar.sources=.  -Dsonar.host.url=http://35.233.231.234 -Dsonar.login=0a0eca3f1ec3dea8fbc7463036d8e7061cb956f6
   test:
     executor:
       name: sonar_analysis
     steps:
       - checkout
       - run: node -v
          
          
workflows:
     build-and-check:
      jobs:
        - semantic_and_sonar_verify
        - test:
            requires: 
              - semantic_and_sonar_verify
              
